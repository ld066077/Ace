# 数值计算与可视化工作流程

  

## 当前文件结构

  

### 主要文件

- `main.f90`: Fortran主程序，负责数值计算

- `plot_xtheta.py`: Python绘图脚本

- `params.dat`: 参数数据文件

- `Xtheta.dat`: 计算结果数据文件

  

### 数据流

1. `main.f90` → `params.dat`: 输出计算参数和网格点

2. `main.f90` → `Xtheta.dat`: 输出计算结果

3. `plot_xtheta.py` 读取上述两个文件并生成可视化结果

  

## 当前工作流程

  

### Fortran计算部分 (main.f90)

1. 设置计算参数：

- 网格大小：`grid = 30`

- 测量点：`diag_theta = 0.0`

- 参数范围：`s, alpha ∈ [0, 3]`

2. 进行数值计算

3. 输出结果到数据文件

  

### Python可视化部分 (plot_xtheta.py)

1. 读取数据文件

2. 处理数据：

- 区分有/无虚部的点

- 区分正/负实部的点

3. 绘制相图：

- 白色/灰色背景表示虚部特性

- 蓝点/红叉表示实部正负

  

## 改进建议

  

### 1. 数据组织

```fortran

! params.dat格式优化

write(13, '(A)') "# theta/pi"

write(13, '(A)') "# s alpha"

write(13, F10.6) diag_theta

```

  

### 2. 参数控制

  

```txt

！config.txt

grid = 30

diag_theta = 0.0

s_max = 3.0

alpha_max = 3.0

tol = 1.0e-7

```

  

### 3. 目录管理

```fortran

character(len=128) :: output_dir = "output/"

call system('mkdir -p '//trim(output_dir))

```

  

### 4. 进度监控

```fortran

integer :: total_steps = grid grid

integer :: current_step = 0

write(, '(A,F6.2,A)') "Progress: ", &

real(current_step)/real(total_steps)100, "%"

```

  

### 5. Python端改进

```python

# 命令行参数

parser = argparse.ArgumentParser()

parser.add_argument('--input-dir', default='output')

parser.add_argument('--output-file', default='X_phase_diagram.png')

#配置文件

with open('plot_config.yml') as f:

plot_config = yaml.safe_load(f)

```

  

### 6. 版本与日志

  

```fortran

! 版本信息

character(len=), parameter :: VERSION = "1.0.0"

! 日志记录

open(unit=99, file=trim(output_dir)//'run.log', status='unknown')

write(99, ) "Run started at: ", current_time()

```

  

## 实施建议

  

分三个阶段实施改进：

  

### 第一阶段：基础改进

- 优化数据文件格式

- 添加基本错误处理

- 实现目录管理

  

### 第二阶段：功能增强

- 添加配置文件支持

- 实现进度显示

- 改进Python脚本的参数控制

  

### 第三阶段：高级特性

- 添加版本控制

- 实现日志记录

- 完善错误处理和异常恢复

  

## 预期效果

  

改进后的工作流程将具有：

1. 更好的可维护性

2. 更灵活的参数控制

3. 更友好的用户体验

4. 更可靠的错误处理

5. 更完善的追踪记录